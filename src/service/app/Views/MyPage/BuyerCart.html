<?php
  // Left Menu
  require APPPATH . '/Views/Buyer/Components/Left.html';
?>
<div class="flex-grow-1">
  <section class="buyer-cart">
    <div class="auto-container py-5">
      <?php
        // NAV
        require(__DIR__.'/Components/Nav.html');
      ?>
      <h3 class="mt-5 h4 fw-bold text-center">장바구니</h3>
      <div class="px-3 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom ">
          <?php
          $count = 0;
          if(is_array($data)){
          $count = count($data);
          }else{
          $count = 0;
          }
          ?>
          <p>상품목록 (총 <span><?=$count?></span>개)</p>
        </div>
        <table class="table">
          <thead>
          <tr>
            <th>
              상품사진
            </th>
            <th>
              회사명/상품명
            </th>
            <th>
              상품수량
            </th>
            <th>
              계약금액
            </th>
            <th>
              감면액
            </th>
            <th>

            </th>
          </tr>
          </thead>
          <tbody>
          <?php
          if(is_array($data)){
        foreach($data as $item){
         $product_price = number_format($item['cart_product_price']);
         $cart_reduction_money = number_format($item["cart_reduction_money"]);
        ?>
          <tr>
              <td>
                <img src="/uploads/<?=$item['representative_image']?>" alt="<?=$item['cart_product_name']?>">
              </td>
              <td>
                <h4><a href="/Buyer/Shop/Detail/<?=$item['product_no']?>?rm=<?=$item['cart_reduction_money']?>"><span class="text-primary"><?=$item['seller_company']?></span> / <?=$item['cart_product_name']?></a></h4>
              </td>
              <td>
                <p><?=$item['product_quantity']?></p>
              </td>
              <td>
                <p><?=$product_price?>원</p>
              </td>
              <td>
                <p><?=$cart_reduction_money?>원</p>
              </td>
              <td>
                <button onclick="cart_del(<?=$item['idx']?>);" class="btn btn-sm btn-danger">삭제</button>
                <button onclick="contract(<?=$item['product_no']?>);" class="btn btn-sm btn-success">계약하기</button>
              </td>
            </tr>
            <?php
                }
              }
            ?>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>
<script>
  function contract(product_no){
   // document.contractForm.action='/Buyer/Contract';
      var ctype = "cart"
      location.href = "/Buyer/Contract?product_no="+product_no+"&ctype=" + ctype;
  };
  function cart_del(idx){
    var ctype = "cart"
    location.href = "/Buyer/MyPage/CartDel?idx="+idx +"&ctype=" + ctype;

    /*
        document.contractForm.action='/Buyer/MyPage/CartDel';
        document.contractForm.submit();
    */
    /* $.ajax({
       type:"post",
       url:"/Buyer/MyPage/CartDel",
       data:{"idx":idx},
       success:function(result){
         if(result){
           alert("제거되었습니다.");
           location.reload();
         }else{
           alert("실패");
         }
       },error:function(e){
         alert("전송 실패");
       }
     })*/
  }

</script>