<?php
  // Left Menu
  require APPPATH . '/Views/Buyer/Components/Left.html';

      if($_SESSION["login_info"]["type"] != "buyer"){
        echo "<script>alert('다시 로그인을 해주세요');</script>";
        echo "<script>location.href = '/Auth/SignIn';</script>";
      }
?>
<div class="flex-grow-1">
  <section class="buyer-info">
    <div class="auto-container py-5">
      <?php
        // NAV
        require(__DIR__.'/Components/Nav.html');
      ?>

      <ul class="row border w-100 justify-content-around align-items-center my-4 mx-auto py-4 text-center bg-light buyer-info-summary">
        <li class="col-3 px-5 position-relative">
          <p class="h5">장바구니</p>
          <p><strong class="h4 fw-bold"><?=$data['cart']['cart']?></strong> 건</p>
        </li>
        <li class="col-3 px-5 position-relative">
          <p class="h5">계약 진행중</p>
          <p><strong class="h4 fw-bold"><?=$data['contract']['contract']?></strong> 건</p>
        </li>
        <li class="col-3 px-5 position-relative">
          <p class="h5">배송 진행중</span></p>
          <p><strong class="h4 fw-bold"><?=$data['delivery']['delivery']?></strong> 건</p>
        </li>
        <li class="col-3 px-5">
          <p class="h5">포인트</p>
          <p><strong class="h4 fw-bold"><?=number_format($data['point']['point'])?></strong> Point</p>
        </li>
      </ul>
      <h3 class="mt-5 h4 fw-bold text-center">나의정보 수정</h3>
      <div class="default-form border rounded my-4 p-4">
        <div class="form-inner">
          <form name="updateForm" id ="buyer_updateForm" method="post" action="/Buyer/MyPage/BuyerUpdateSubmit" enctype="multipart/form-data">
            <input type="hidden" name="sbs" value="<?=$sbs?>">
            <input type="hidden" name="ads" value="<?=$ads?>">

            <div class="read-only-group">
              <p class="my-2"><sup class="text-danger">*</sup><a title="이메일주소">이메일주소</a></p>
              <p type="text"><?=$data["email"]?></p>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="비밀번호 필수입력">현재 비밀번호</a></label>
              <input type="password" name="password" id ="password" placeholder="영문+숫자+특수문자 조합 6자 이상" title="영문+숫자+특수문자 조합 6자 이상 비밀번호 입력" tabindex=100 required>
            </div>

            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="담당자 이름 필수입력">담당자 이름</a></label>
              <input type="text" name="buyer_name" value ="<?=$data['buyer_name']?>" placeholder="담당자이름을 입력해주세요" title="담당자 이름 입력" tabindex=100 required>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="휴대폰번호 필수입력">휴대폰번호</a></label>
              <input type="text" class="mask-phone" value ="<?=$data['phone']?>" name="phone" placeholder="숫자, '-'만 입력" title="휴대폰번호 숫자, '-'만 입력" tabindex=100 required>
            </div>
            <div class="read-only-group">
              <p class="my-2"><sup class="text-danger">*</sup><a title="사업체명 필수입력">사업체명</a></p>
              <p title="사업체명"><?=$data["company_name"]?></p>
            </div>
            <div class="read-only-group">
              <p class="my-2"><sup class="text-danger">*</sup><a title="사업자등록번호 필수입력">사업자등록번호</a></small></p>
              <p type="text" title="사업자등록번호"><?=$data["company_code"]?></p>
            </div>
            <div class="form-group">
              <p class="mt-4 mb-2"><sup class="text-danger">*</sup><a title="기업형태 필수입력" class="text-dark">기업형태</a></p>
              <label class="me-3">
                <input type="radio" name="classification" value="1" <?php if($data['classification']==1){echo "checked";}?>>민간기업
              </label>
              <label class="me-3">
                <input type="radio" name="classification" value="2" <?php if($data['classification']==2){echo "checked";}?>>공공기관
              </label>
              <label class="me-3">
                <input type="radio" name="classification" value="3" <?php if($data['classification']==3){echo "checked";}?>>국가/자치단체
              </label>
            </div>
            <div class="form-group">
              <label class="my-2"><a title="팩스번호">팩스번호</a></label>
              <input type="text" class="mask-phone" value ="<?=$data['fax']?>" name="fax" placeholder="숫자, '-'만 입력" title="팩스번호 숫자, '-'만 입력" tabindex=100>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="담당자 이름 필수입력">주소</a></label>
              <input type="text" name="address" value ="<?=$data['address']?>" placeholder="주소를 입력해주세요" title="담당자 이름 입력"  tabindex=100 required>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="상시 근로자 수 필수입력">상시 근로자 수 </a></label>
              <input type="text" name="workers" id ="workers" value ="<?=$data['workers']?>" placeholder="숫자만 입력" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')" title="상시 근로자 수 입력" tabindex=100 required>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="경증 장애인 근로자 수 필수입력">경증 장애인 근로자 수</a></label>
              <input type="text" name="mild_disabled" id ="mild_disabled" value ="<?=$data['mild_disabled']?>" placeholder="숫자만 입력" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')" title="경증 장애인 근로자 수 입력" tabindex=100 required>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="중증 장애인 근로자 수 필수입력">중증 장애인 근로자 수</a></label>
              <input type="text" name="severely_disabled" id ="severely_disabled" value ="<?=$data['severely_disabled']?>" placeholder="숫자만 입력" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')" title="중증 장애인 근로자 수 입력" tabindex=100 required>
            </div>
            <div class="form-group">
              <label class="my-2"><sup class="text-danger">*</sup><a title="적용 법인세율">적용 법인세율</a></label>
              <input type="text" name="tax_rate" value ="<?=$data['tax_rate']?>" placeholder="숫자만 입력" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1')" title="적용법인 세율 입력" tabindex=100 >
            </div>
            <div class="">
              <p class="my-2"><a title="관심상품">관심상품</a></p>
              <label class="form-check-label me-1"><input class="form-check-input" type="checkbox" value="Y" name="interest_office" <?php if($data['interest_office']=='Y'){echo "checked";}?>> 사무용품</label>
              <label class="form-check-label me-1"><input class="form-check-input" type="checkbox" value="Y" name="interest_daily" <?php if($data['interest_daily']=='Y'){echo "checked";}?>> 생활용품</label>
              <label class="form-check-label me-1"><input class="form-check-input" type="checkbox" value="Y" name="interest_computerized" <?php if($data['interest_computerized']=='Y'){echo "checked";}?>> 전산용품</label>
              <label class="form-check-label me-1"><input class="form-check-input" type="checkbox" value="Y" name="interest_food" <?php if($data['interest_food']=='Y'){echo "checked";}?>> 식음료</label>
              <label class="form-check-label me-1"><input class="form-check-input" type="checkbox" value="Y" name="interest_cleaning" <?php if($data['interest_cleaning']=='Y'){echo "checked";}?>> 청소용품</label>
            </div>
            <br>
            <div class="form-group">
              <label class="my-2"><a title="사업자등록증 첨부">사업자등록증 첨부</a></label>
              <button class="btn btn-outline-secondary btn-sm fw-normal my-2" type="button"  onclick="downloadFileNew('<?=$data["buyer_documents"]?>','<?=$data["buyer_documents_ori"]?>');">기존파일 다운로드</button>
              <input type="file" name="buyer_documents" class="form-control" placeholder="사업자등록증 첨부"
                     title="사업자등록증 첨부" tabindex=100>
              <input type="hidden" name="buyer_documents" value='<?=$data["buyer_documents"]?>'>
              <input type="hidden" name="buyer_documents_ori" value='<?=$data["buyer_documents_ori"]?>'>
            </div>
            <div class="form-group mt-5 d-flex justify-content-center">
              <button type="button" onclick="history.back()" class="theme-btn btn-style-three py-3 me-3" tabindex=100>취소</button>
              <button type="button" class="theme-btn btn-style-one py-3" onclick="buyerInfoValidation();" tabindex=100>수정</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
</div>
<script>

  function downloadFileNew(fileName,fileNameOri){
    if(fileName == ""){
      alert("등록된 파일이 없습니다");
    }else {
      fileNameOri = fileNameOri.replace('&','"\&\"');
      //alert("/Buyer/MyPage/downloadFileNew?fileName=" + fileName + "&fileNameOri=" + fileNameOri);
      location.href = "/Buyer/MyPage/downloadFileNew?fileName=" + fileName + "&fileNameOri=" + fileNameOri;
    }
  };

  function buyerInfoValidation(){

    if($("#password").val() == ""){
      alert("비밀번호를 입력해주세요");
      return false;
    }

    var workers_count = parseInt($("#workers").val());
    var severely_disabled_count = parseInt($("#severely_disabled").val());
    var mild_disabled_count = parseInt($("#mild_disabled").val());

    if(workers_count < severely_disabled_count + mild_disabled_count){
      alert("장애인 근로자 수가 상시 근로자 수 보다 많습니다.");
    }else{
      $("#buyer_updateForm").submit();
    }
  }
</script>